<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Realtime Overlay (EMQX)</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mqtt/4.3.7/mqtt.min.js"></script>
    <style>
        body {
            background-color: transparent !important;
            margin: 0; padding: 0; overflow: hidden;
            display: flex; align-items: center; justify-content: flex-start;
            height: 100vh;
        }
        .overlay-container {
            font-family: 'Poppins', sans-serif;
            font-size: 120px; font-weight: 900; color: #ffffff;
            -webkit-text-stroke: 3px black; text-shadow: 5px 5px 0px #000000;
            line-height: 1; padding-left: 10px;
        }
        .pop { animation: pop 0.2s ease-in-out; }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="overlay-container" id="container">
        <span id="displayWins">0</span>/<span id="displayTarget">5</span>
    </div>
    <script>
        // *** ต้องตรงกับ index.html ***
        const ROOM_TOPIC = 'coolkris_room_999'; 
        const MQTT_HOST = 'wss://broker.emqx.io:8084/mqtt'; // Server ใหม่
        
        const clientId = 'overlay_' + Math.random().toString(16).substr(2, 8);
        const displayWins = document.getElementById('displayWins');
        const displayTarget = document.getElementById('displayTarget');
        const container = document.getElementById('container');
        
        console.log("Connecting...");
        const client = mqtt.connect(MQTT_HOST, { 
            clientId: clientId,
            clean: true,
            connectTimeout: 4000,
        });

        client.on('connect', () => {
            console.log("Connected!");
            client.subscribe(ROOM_TOPIC);
        });

        client.on('message', (topic, message) => {
            try {
                const data = JSON.parse(message.toString());
                if (displayWins.innerText != data.wins) {
                    displayWins.innerText = data.wins;
                    container.classList.remove('pop');
                    void container.offsetWidth; 
                    container.classList.add('pop');
                }
                displayTarget.innerText = data.target;
            } catch (e) { console.error(e); }
        });
    </script>
</body>
</html>
